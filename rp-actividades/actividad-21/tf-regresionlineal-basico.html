<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Regresion Lineal B</title>
  </head>
  <body>
    <p>Modelo de regresión líneal con Tensor Flow, Entrenando la red...</p>
    <p id="avance"></p>
  </body>
  <!-- Load TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.13.0"> </script>
  <script>
    const epocas = 700; // número de épocas para el entrenamiento
    console.log("modelo entrenado con los datos:x=[1, 2, 3, 4], y=[1, 3, 5, 7]")
    // Define un modelo para regresión lineal0.
    const model = tf.sequential();
    model.add(tf.layers.dense({units: 1, inputShape: [1]}));
    // Prepara el modelo para entrenamiento especificando: la perdida (loss) y la optimización(optimizer).
    model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});
    // tag para mostrar el avance
    const progreso = document.querySelector('#avance');
    progreso.innerText = `Progreso: 0/${epocas} épocas completadas`;
    
    // Ponemos algunos datos y etiquetas para entrenamiento
    const xs = tf.tensor2d([1, 2, 3, 4], [4, 1]);
    const ys = tf.tensor2d([1, 3, 5, 7], [4, 1]);
    // entrenamos el modelo usando los datos
    model.fit(xs, ys, {
      epochs: epocas,
      callbacks: {
        onEpochEnd: (epoch) => {
          progreso.innerText = `Progreso: ${epoch + 1}/${epocas} épocas completadas`;
        }
      }
    }).then(() => {
      // Use el modelo para hacer inferencias sobre un punto de datos que el modelo no haya visto antes:
      //aqui por ejemplo sobre el dato 5
      // Abra la consola en las herramientas de desarrollo del navegador para ver el resultado
      console.log("predicción para el dato 5:")
      document.body.innerHTML = `
      <h4>Regresión línal</h4>
      <p>modelo entrenado para los datos:<br>
        x=[1, 2, 3, 4] <br>
        y=[1, 3, 5, 7]</p>
      con ${epocas} epocas, 
      Vea la predicción para el valor x=5 en la consola:
      `
      model.predict(tf.tensor2d([5], [1, 1])).print();
    });
  </script>
</html>